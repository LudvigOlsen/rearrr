---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, echo = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  dpi = 92,
  fig.retina = 2
)

# Get minimum R requirement 
dep <- as.vector(read.dcf('DESCRIPTION')[, 'Depends'])
rvers <- substring(dep, 7, nchar(dep)-1)
# m <- regexpr('R *\\\\(>= \\\\d+.\\\\d+.\\\\d+\\\\)', dep)
# rm <- regmatches(dep, m)
# rvers <- gsub('.*(\\\\d+.\\\\d+.\\\\d+).*', '\\\\1', dep)

# Function for TOC
# https://gist.github.com/gadenbuie/c83e078bf8c81b035e32c3fc0cf04ee8


```
<!-- # rearrr <a href='https://github.com/LudvigOlsen/rearrr'><img src='man/figures/rearrr_logo_242x280_250dpi.png' align="right" height="140" /></a> -->
# rearrr
**Rearrrange Data**  
**Authors:** [Ludvig R. Olsen](http://ludvigolsen.dk/) ( r-pkgs@ludvigolsen.dk ) <br/>
**License:** [MIT](https://opensource.org/licenses/MIT) <br/>
**Started:** April 2020  

[![CRAN_Status_Badge](https://www.r-pkg.org/badges/version/rearrr)](https://cran.r-project.org/package=rearrr)
[![metacran downloads](https://cranlogs.r-pkg.org/badges/rearrr)](https://cran.r-project.org/package=rearrr)
[![minimal R version](https://img.shields.io/badge/R%3E%3D-`r rvers`-6666ff.svg)](https://cran.r-project.org/)
[![Codecov test coverage](https://codecov.io/gh/ludvigolsen/rearrr/branch/master/graph/badge.svg)](https://codecov.io/gh/ludvigolsen/rearrr?branch=master)
[![Travis build status](https://travis-ci.org/LudvigOlsen/rearrr.svg?branch=master)](https://travis-ci.org/LudvigOlsen/rearrr)
[![AppVeyor build status](https://ci.appveyor.com/api/projects/status/github/LudvigOlsen/rearrr?branch=master&svg=true)](https://ci.appveyor.com/project/LudvigOlsen/rearrr)
<!-- [![DOI](https://zenodo.org/badge/71063931.svg)](https://zenodo.org/badge/latestdoi/71063931) -->


## Overview

R package for rearranging data by a set of methods.

We distinguish between **rearrangers** and **mutators**, where the first *reorders* the data points and the second *changes the values* of the data points.

### Rearrangers

| Function              | Description                                                           |
|:----------------------|:----------------------------------------------------------------------|
|`center_max()`         |Center the highest value with values decreasing around it.             |
|`center_min()`         |Center the lowest value with values increasing around it.              |
|`position_max()`       |Position the highest value with values decreasing around it.           |
|`position_min()`       |Position the lowest value with values increasing around it.            |
|`pair_extremes()`      |Arrange values as highest, lowest, second highest, second lowest, etc. |
|`closest_to()`         |Order values by shortest distance to a target.                         |
|`furthest_from()`      |Order values by longest distance to a target.                          |
|`rev_windows()`        |Reverse order window-wise.                                             |

### Mutators

| Function              | Description                                                           | Dimensions |
|:----------------------|:----------------------------------------------------------------------|:-----------|
|`flip_values()`        |Flip the values around a center value.                                 |n           |
|`expand_values()`      |Expand values around around an origin.                                 |n           |
|`cluster_groups()`     |Move data points into clusters around group centroids.                 |n           |
|`dim_values()`         |Dim values of a dimension by the distance to an n-dimensional origin.  |n (alters 1)|
|`rotate2d()`           |Rotate values around an origin in 2 dimensions.                        |2           |

### Generators

| Function              | Description                                                           |
|:----------------------|:----------------------------------------------------------------------|
|`generate_clusters()`  |Generate n-dimensional clusters.                                       |

### Helpers

| Function              | Description                                                           |
|:----------------------|:----------------------------------------------------------------------|
|`create_origin_fn()`   |Creates function for finding origin coordinates (like `centroid()`).   |
|`centroid()`           |Calculates the mean of each supplied vector.                           |
|`transfer_centroids()` |Transfer centroids from one `data.frame` to another.                   |
|`min_max_scale()`      |Scale values to a range.                                               |


## Table of Contents

```{r toc, echo=FALSE}
rearrr:::render_toc("README.Rmd", toc_depth = 4)
```

## Installation

<!-- CRAN: -->

<!-- > `install.packages("rearrr")` -->

Development version:  

> `install.packages("devtools")`  
>
> `devtools::install_github("LudvigOlsen/rearrr")`  

<!-- ## Vignettes   -->

<!-- `rearrr` contains a number of vignettes with relevant use cases and descriptions:   -->

<!-- > `vignette(package = "rearrr")` # for an overview    -->

## Attach packages

Let's see some **examples**. We start by attaching the necessary packages:

```{r warning=FALSE, message=FALSE}
library(rearrr)
library(knitr)        # kable()
library(dplyr)        # %>% arrange()
library(tidyr)        # gather()
library(ggplot2)

xpectr::set_test_seed(1)
```

```{r include=FALSE}
vec <- 1:10
random_sample <- runif(10)
orderings <- data.frame(
  "Position" = as.integer(vec),
  "center_max" = center_max(vec),
  "center_min" = center_min(vec),
  "position_max" = position_max(vec, position = 3),
  "position_min" = position_min(vec, position = 3),
  "pair_extremes" = pair_extremes(vec),
  "rev_windows" = rev_windows(vec, window_size = 3),
  "closest_to" = closest_to(vec, target_fn = median),
  "furthest_from" = furthest_from(vec, target = 5),
  "random_sample" = random_sample,
  "flipped_median" = flip_values(random_sample, center_fn=create_origin_fn(median))$Value_flipped
) 

# Convert to long format for plotting
orderings <- orderings %>% 
  tidyr::gather(key = "Method", value = "Value", 2:(ncol(orderings))) 

gg_line_alpha <- .4
gg_base_line_size <- .3

```


<!-- Note: The `kable()` function simply **formats** the output and is not required. -->

While we can use the functions with data frames, we showcase many of them with a vector for simplicity.
The functions work with grouped data frames and in `magrittr` pipelines (`%>%`).

## Rearranger examples

Rearrangers change the order of the data points.

### Center min/max

```{r}
center_max(data = 1:10)
```

```{r}
center_min(data = 1:10)
```

```{r echo=FALSE, fig.align='center', fig.width=6, fig.height=3.5}
# Plot centering methods
orderings %>% 
  dplyr::filter(Method %in% c("center_min", "center_max")) %>% 
  ggplot(aes(x = Position, y = Value, color = Method)) + 
  geom_line(alpha = gg_line_alpha) + 
  geom_point() + 
  theme_minimal(base_line_size = gg_base_line_size) + 
  scale_x_continuous(breaks = c(2, 4, 6, 8, 10)) +
  scale_y_continuous(breaks = c(2, 4, 6, 8, 10)) +
  scale_colour_brewer(palette = "Dark2")
```

### Position min/max

```{r}
position_max(data = 1:10, position = 3)
```

```{r}
position_min(data = 1:10, position = 3)
```

```{r echo=FALSE, fig.align='center', fig.width=6, fig.height=3.5}
# Plot positioning methods
orderings %>% 
  dplyr::filter(Method %in% c("position_min", "position_max")) %>% 
  ggplot(aes(x = Position, y = Value, color = Method)) + 
  geom_line(alpha = gg_line_alpha) + 
  geom_point() +
  theme_minimal(base_line_size = gg_base_line_size) + 
  scale_x_continuous(breaks = c(2, 4, 6, 8, 10)) +
  scale_y_continuous(breaks = c(2, 4, 6, 8, 10)) +
  scale_colour_brewer(palette = "Dark2")
```

### Pair extremes

```{r}
pair_extremes(data = 1:10, keep_factor = TRUE)
```

```{r echo=FALSE, fig.align='center', fig.width=6, fig.height=3.5}
# Plot extreme pairing
orderings %>% 
  dplyr::filter(Method == "pair_extremes") %>% 
  ggplot(aes(x = Position, y = Value, color = Method)) + 
  geom_line(alpha = gg_line_alpha) + 
  geom_point() + 
  theme_minimal(base_line_size = gg_base_line_size) + 
  scale_x_continuous(breaks = c(2, 4, 6, 8, 10)) +
  scale_y_continuous(breaks = c(2, 4, 6, 8, 10)) +
  scale_colour_brewer(palette = "Dark2")
```

### Closest to / furthest from

The target value/index can be passed as either a specific value or a function.

```{r}
closest_to(data = 1:10, target_fn = median)
```

```{r}
furthest_from(data = 1:10, target = 5)
```

```{r echo=FALSE, fig.align='center', fig.width=6, fig.height=3.5}
# Plot distanced order
orderings %>% 
  dplyr::filter(Method %in% c("closest_to", "furthest_from")) %>% 
  ggplot(aes(x = Position, y = Value, color = Method)) + 
  geom_line(alpha = gg_line_alpha) + 
  geom_point() + 
  theme_minimal(base_line_size = gg_base_line_size) + 
  scale_x_continuous(breaks = c(2, 4, 6, 8, 10)) +
  scale_y_continuous(breaks = c(2, 4, 6, 8, 10)) +
  scale_colour_brewer(palette = "Dark2")
```

### Reverse windows

```{r}
rev_windows(data = 1:10, window_size = 3)
```

```{r echo=FALSE, fig.align='center', fig.width=6, fig.height=3.5}
# Plot windowed reversing
orderings %>% 
  dplyr::filter(Method == "rev_windows") %>% 
  ggplot(aes(x = Position, y = Value, color = Method)) + 
  geom_line(alpha = gg_line_alpha) + 
  geom_point() + 
  theme_minimal(base_line_size = gg_base_line_size) + 
  scale_x_continuous(breaks = c(2, 4, 6, 8, 10)) +
  scale_y_continuous(breaks = c(2, 4, 6, 8, 10)) +
  scale_colour_brewer(palette = "Dark2")
```

## Mutator examples

Mutators change the values of the data points.

### Flip values

```{r}
# Set seed for reproducibility
xpectr::set_test_seed(1)

# Draw random numbers 
random_sample <- round(runif(10), digits=4)
random_sample

# The median value to flip around
median(random_sample)

# Flip the random numbers around the median
flip_values(data = random_sample, center_fn = create_origin_fn(median))
```

```{r echo=FALSE, fig.align='center', fig.width=6, fig.height=3.5}
# Plot flipped values
orderings %>% 
  dplyr::filter(Method %in% c("random_sample", "flipped_median")) %>% 
  ggplot(aes(x = Position, y = Value, color = Method)) + 
  geom_line(alpha = gg_line_alpha) + 
  geom_point() + 
  theme_minimal(base_line_size = gg_base_line_size) + 
  scale_x_continuous(breaks = c(2, 4, 6, 8, 10)) +
  scale_colour_brewer(palette = "Dark2")
```

### Rotate values

```{r}
rotate2d(random_sample, degrees = 60, origin_fn = centroid)
```

```{r echo=FALSE, fig.align='center', fig.width=6, fig.height=3.5}
rotate_df <- rotate2d(random_sample, degrees = c(0, 72, 144, 216, 288), origin_fn = centroid)

# Plot rotated values
rotate_df %>% 
  ggplot(aes(x = Index_rotated, y = Value_rotated, color = factor(.degrees))) +
  geom_hline(yintercept = mean(random_sample), size = 0.2, alpha = gg_line_alpha, linetype="dashed") +
  geom_vline(xintercept = mean(seq_len(length(random_sample))), size = 0.2, alpha = gg_line_alpha, linetype="dashed") +
  geom_line(alpha = gg_line_alpha) + 
  geom_point() + 
  theme_minimal(base_line_size = gg_base_line_size) + 
  scale_colour_brewer(palette = "Dark2") + 
  labs(x = "Index", y="Value", color="Degrees")

```

### Expand values in n dimensions

```{r}
# 1d expansion
expand_values(
  random_sample,
  multipliers = 3,
  origin_fn = centroid,
  exponentiate = TRUE
)
```

2d expansion:

```{r echo=FALSE, fig.align='center', fig.width=6, fig.height=3.5}
xpectr::set_test_seed(36)
random_x <- runif(10)
random_y <- runif(10)
expand_df <- purrr::map_dfr(
  .x = c(1, 2, 3, 4, 5),
  .f = function(exponent) {
    expand_values(
      data.frame("x" = random_x,
                 "y" = random_y),
      cols = c("x", "y"),
      multipliers = exponent,
      origin_fn = centroid,
      exponentiate = TRUE
    )
  }
)

# Plot rotated values
expand_df %>% 
  ggplot(aes(x = x_expanded, y = y_expanded, color = factor(.exponents))) +
  geom_hline(yintercept = mean(random_x), size = 0.2, alpha = gg_line_alpha, linetype="dashed") +
  geom_vline(xintercept = mean(random_y), size = 0.2, alpha = gg_line_alpha, linetype="dashed") +
  geom_line(alpha = gg_line_alpha) + 
  geom_point() + 
  theme_minimal(base_line_size = gg_base_line_size) + 
  scale_colour_brewer(palette = "Dark2") + 
  labs(x = "x", y="y", color="Exponent")

```

### Cluster groups

```{r}
# Set seed for reproducibility
xpectr::set_test_seed(3)

# Create data frame with random data and a grouping variable
df <- data.frame(
  "x" = runif(50),
  "y" = runif(50),
  "g" = rep(c(1, 2, 3, 4, 5), each = 10)
) 

cluster_groups(df, cols = c("x", "y"), group_col = "g")
```

```{r echo=FALSE, fig.align='center', fig.width=6, fig.height=3.5}
df_clustered <- cluster_groups(df, cols = c("x", "y"), group_col = "g")

ggplot(df_clustered, aes(x = x_clustered, y = y_clustered, color = factor(g))) +
  # Original data
  geom_point(aes(x = x, y = y), alpha = 0.3, size = 0.8) +
  # Clustered data
  geom_point() +
  theme_minimal(base_line_size = gg_base_line_size) + 
  scale_colour_brewer(palette = "Dark2") + 
  labs(x = "x", y = "y", color = "g")

df_clustered <- df_clustered %>% 
  dplyr::select(x_clustered, y_clustered, g)
```

### Dim values

```{r}
# Add a column with 1s
df_clustered$o <- 1

# Dim the "o" column (uses last column in `cols` by default)
# based on the data point's distance to the cluster centroid
df_clustered %>% 
  dplyr::group_by(g) %>% 
  dim_values(cols = c("x_clustered", "y_clustered", "o"), origin_fn = centroid)
```

```{r echo=FALSE, fig.align='center', fig.width=6, fig.height=3.5}
df_dimmed <- df_clustered %>% 
  dplyr::group_by(g) %>% 
  dim_values(cols = c("x_clustered", "y_clustered", "o"), origin_fn = centroid)

ggplot(df_dimmed, aes(x = x_clustered, y = y_clustered, alpha = o_dimmed, color = factor(g))) +
  geom_point() +
  theme_minimal(base_line_size = gg_base_line_size) + 
  scale_colour_brewer(palette = "Dark2") + 
  labs(x = "x", y = "y", color = "g", alpha = "o_dimmed")
```


## Generators

### Generate clusters

```{r echo=FALSE, fig.align='center', fig.width=6, fig.height=3.5}
xpectr::set_test_seed(10)
```

```{r}
generate_clusters(num_rows = 50, num_cols = 5, num_clusters = 5, compactness = 1.6)
```

```{r echo=FALSE, fig.align='center', fig.width=6, fig.height=3.5}
xpectr::set_test_seed(10)

df_clusters <- generate_clusters(
  num_rows = 50, num_cols = 5,
  num_clusters = 5, compactness = 1.6
  ) 
df_clusters %>% 
  ggplot(
    aes(x = D1, y = D2, color = .cluster)) +
    geom_point() +
    theme_minimal(base_line_size = gg_base_line_size) + 
    scale_colour_brewer(palette = "Dark2") + 
    labs(x = "D1", y = "D2", color = "Cluster")

```

